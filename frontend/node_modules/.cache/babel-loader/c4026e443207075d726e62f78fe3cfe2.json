{"ast":null,"code":"var _jsxFileName = \"/home/abdul-rehman/Downloads/MERN_E-Commerce-main/frontend/src/component/Cart/Payment.js\",\n    _s = $RefreshSig$();\n\nimport React, { Fragment, useEffect, useRef } from \"react\";\nimport CheckoutSteps from \"./CheckOutSteps\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport MetaData from \"../layout/MetaData\";\nimport { Typography } from \"@material-ui/core\";\nimport { useAlert } from \"react-alert\";\nimport { CardNumberElement, CardCvcElement, CardExpiryElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport axios from \"axios\";\nimport \"./Payment.css\";\nimport CreditCardIcon from \"@material-ui/icons/CreditCard\";\nimport EventIcon from \"@material-ui/icons/Event\";\nimport VpnKeyIcon from \"@material-ui/icons/VpnKey\";\nimport { createOrder, clearErrors } from \"../../actions/orderAction\";\nimport { useNavigate } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Payment = () => {\n  _s();\n\n  const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"));\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const alert = useAlert();\n  const stripe = useStripe();\n  const elements = useElements();\n  const payBtn = useRef(null);\n  const {\n    shippingInfo,\n    cartItems\n  } = useSelector(state => state.cart);\n  const {\n    user\n  } = useSelector(state => state.user);\n  const {\n    error\n  } = useSelector(state => state.newOrder);\n  const paymentData = {\n    amount: Math.round(orderInfo.totalPrice * 100)\n  };\n  const order = {\n    shippingInfo,\n    orderItems: cartItems,\n    itemsPrice: orderInfo.subtotal,\n    taxPrice: orderInfo.tax,\n    shippingPrice: orderInfo.shippingCharges,\n    totalPrice: orderInfo.totalPrice\n  };\n\n  const submitHandler = async e => {\n    e.preventDefault();\n    payBtn.current.disabled = true;\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      const {\n        data\n      } = await axios.post(\"/api/v1/payment/process\", paymentData, config);\n      const client_secret = data.client_secret;\n      if (!stripe || !elements) return;\n      const result = await stripe.confirmCardPayment(client_secret, {\n        payment_method: {\n          card: elements.getElement(CardNumberElement),\n          billing_details: {\n            name: user.name,\n            email: user.email,\n            address: {\n              line1: shippingInfo.address,\n              city: shippingInfo.city,\n              state: shippingInfo.state,\n              postal_code: shippingInfo.pinCode,\n              country: shippingInfo.country\n            }\n          }\n        }\n      });\n\n      if (result.error) {\n        payBtn.current.disabled = false;\n        alert.error(result.error.message);\n      } else {\n        if (result.paymentIntent.status === \"succeeded\") {\n          order.paymentInfo = {\n            id: result.paymentIntent.id,\n            status: result.paymentIntent.status\n          };\n          dispatch(createOrder(order));\n          navigate(\"/success\");\n        } else {\n          alert.error(\"There's Some Issue While Processing Payment \");\n        }\n      }\n    } catch (error) {\n      payBtn.current.disabled = false;\n      alert.error(error.response.data.message);\n    }\n  };\n\n  useEffect(() => {\n    if (error) {\n      alert.error(error);\n      dispatch(clearErrors());\n    }\n  }, [dispatch, error, alert]);\n  return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(MetaData, {\n      title: \"Payment\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CheckoutSteps, {\n      activeStep: 2\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"paymentContainer\",\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        className: \"paymentForm\",\n        onSubmit: e => submitHandler(e),\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          children: \"Card Info\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(CreditCardIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(CardNumberElement, {\n            className: \"paymentInput\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(EventIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(CardExpiryElement, {\n            className: \"paymentInput\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 132,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(VpnKeyIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(CardCvcElement, {\n            className: \"paymentInput\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"submit\",\n          value: `Pay - $${orderInfo && orderInfo.totalPrice}`,\n          ref: payBtn,\n          className: \"paymentFormBtn\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 120,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Payment, \"65tpyhAseaVT79TYC8qr3AXrvLY=\", false, function () {\n  return [useDispatch, useNavigate, useAlert, useStripe, useElements, useSelector, useSelector, useSelector];\n});\n\n_c = Payment;\nexport default Payment;\n\nvar _c;\n\n$RefreshReg$(_c, \"Payment\");","map":{"version":3,"names":["React","Fragment","useEffect","useRef","CheckoutSteps","useSelector","useDispatch","MetaData","Typography","useAlert","CardNumberElement","CardCvcElement","CardExpiryElement","useStripe","useElements","axios","CreditCardIcon","EventIcon","VpnKeyIcon","createOrder","clearErrors","useNavigate","Payment","orderInfo","JSON","parse","sessionStorage","getItem","dispatch","navigate","alert","stripe","elements","payBtn","shippingInfo","cartItems","state","cart","user","error","newOrder","paymentData","amount","Math","round","totalPrice","order","orderItems","itemsPrice","subtotal","taxPrice","tax","shippingPrice","shippingCharges","submitHandler","e","preventDefault","current","disabled","config","headers","data","post","client_secret","result","confirmCardPayment","payment_method","card","getElement","billing_details","name","email","address","line1","city","postal_code","pinCode","country","message","paymentIntent","status","paymentInfo","id","response"],"sources":["/home/abdul-rehman/Downloads/MERN_E-Commerce-main/frontend/src/component/Cart/Payment.js"],"sourcesContent":["import React, { Fragment, useEffect, useRef } from \"react\";\nimport CheckoutSteps from \"./CheckOutSteps\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport MetaData from \"../layout/MetaData\";\nimport { Typography } from \"@material-ui/core\";\nimport { useAlert } from \"react-alert\";\nimport {\n  CardNumberElement,\n  CardCvcElement,\n  CardExpiryElement,\n  useStripe,\n  useElements,\n} from \"@stripe/react-stripe-js\";\n\nimport axios from \"axios\";\nimport \"./Payment.css\";\nimport CreditCardIcon from \"@material-ui/icons/CreditCard\";\nimport EventIcon from \"@material-ui/icons/Event\";\nimport VpnKeyIcon from \"@material-ui/icons/VpnKey\";\nimport { createOrder, clearErrors } from \"../../actions/orderAction\";\nimport { useNavigate } from \"react-router-dom\";\n\nconst Payment = () => {\n  const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"));\n\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const alert = useAlert();\n  const stripe = useStripe();\n  const elements = useElements();\n  const payBtn = useRef(null);\n\n  const { shippingInfo, cartItems } = useSelector((state) => state.cart);\n  const { user } = useSelector((state) => state.user);\n  const { error } = useSelector((state) => state.newOrder);\n\n  const paymentData = {\n    amount: Math.round(orderInfo.totalPrice * 100),\n  };\n\n  const order = {\n    shippingInfo,\n    orderItems: cartItems,\n    itemsPrice: orderInfo.subtotal,\n    taxPrice: orderInfo.tax,\n    shippingPrice: orderInfo.shippingCharges,\n    totalPrice: orderInfo.totalPrice,\n  };\n\n  const submitHandler = async (e) => {\n    e.preventDefault();\n\n    payBtn.current.disabled = true;\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      };\n      const { data } = await axios.post(\n        \"/api/v1/payment/process\",\n        paymentData,\n        config\n      );\n\n      const client_secret = data.client_secret;\n\n      if (!stripe || !elements) return;\n\n      const result = await stripe.confirmCardPayment(client_secret, {\n        payment_method: {\n          card: elements.getElement(CardNumberElement),\n          billing_details: {\n            name: user.name,\n            email: user.email,\n            address: {\n              line1: shippingInfo.address,\n              city: shippingInfo.city,\n              state: shippingInfo.state,\n              postal_code: shippingInfo.pinCode,\n              country: shippingInfo.country,\n            },\n          },\n        },\n      });\n\n      if (result.error) {\n        payBtn.current.disabled = false;\n\n        alert.error(result.error.message);\n      } else {\n        if (result.paymentIntent.status === \"succeeded\") {\n          order.paymentInfo = {\n            id: result.paymentIntent.id,\n            status: result.paymentIntent.status,\n          };\n\n          dispatch(createOrder(order));\n\n          navigate(\"/success\");\n        } else {\n          alert.error(\"There's Some Issue While Processing Payment \");\n        }\n      }\n    } catch (error) {\n      payBtn.current.disabled = false;\n      alert.error(error.response.data.message);\n    }\n  };\n\n  useEffect(() => {\n    if (error) {\n      alert.error(error);\n      dispatch(clearErrors());\n    }\n  }, [dispatch, error, alert]);\n\n  return (\n    <Fragment>\n      <MetaData title=\"Payment\" />\n      <CheckoutSteps activeStep={2} />\n      <div className=\"paymentContainer\">\n        <form className=\"paymentForm\" onSubmit={(e) => submitHandler(e)}>\n          <Typography>Card Info</Typography>\n          <div>\n            <CreditCardIcon />\n            <CardNumberElement className=\"paymentInput\" />\n          </div>\n          <div>\n            <EventIcon />\n            <CardExpiryElement className=\"paymentInput\" />\n          </div>\n          <div>\n            <VpnKeyIcon />\n            <CardCvcElement className=\"paymentInput\" />\n          </div>\n\n          <input\n            type=\"submit\"\n            value={`Pay - $${orderInfo && orderInfo.totalPrice}`}\n            ref={payBtn}\n            className=\"paymentFormBtn\"\n          />\n        </form>\n      </div>\n    </Fragment>\n  );\n};\n\nexport default Payment;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}